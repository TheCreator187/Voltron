<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="description" content="VoltronBot - Boost your meme coin volume on Raydium and automate sneaker purchases.">
    <meta name="keywords" content="solana volume bot, meme coin booster, raydium trading, sneaker bot">
    <meta name="author" content="CryptoVoltron Team">
    <title>VoltronBot - Meme Coin & Sneaker Automation</title>
    <link href="https://fonts.googleapis.com/css2?family=Exo+2:wght@400;600;800&family=Orbitron:wght@500;700&family=Rajdhani:wght@400;600&display=swap" rel="stylesheet">
    <link href="css/styles.css" rel="stylesheet" type="text/css">
</head>
<body>
    <div class="background">
        <div class="gradient-overlay"></div>
        <div class="grid-lines"></div>
        <div id="particles-js"></div>
    </div>

    <nav class="navbar">
        <a href="#" class="logo">
            <span class="logo-text">VoltronBot</span>
            <span class="logo-subtext">by B TechLabs</span>
        </a>
        <span class="menu-toggle">‚ò∞</span>
        <div class="nav-links">
            <a href="#home">Home</a>
            <a href="#volume-bot">Volume Bot</a>
            <a href="#sneaker-bot" class="highlight-link">Sneaker Bot</a>
            <a href="billing.html">Billing</a>
            <a href="#signup">Sign Up</a>
            <a href="#contact">Contact</a>
        </div>
    </nav>

    <section class="hero" id="home">
        <div class="hero-background">
            <img src="images/space.jpg" alt="Crypto Space Background">
        </div>
        <div class="content">
            <h1>Boost Your Meme Coin & Cop Sneakers</h1>
            <p>Supercharge your meme coin volume on Raydium and automate sneaker purchases with ease.</p>
            <button id="add-wallet-btn" class="button" onclick="connectWallet()">Connect Phantom Wallet</button>
            <div id="wallet-status" class="wallet-status"></div>
        </div>
    </section>

    <main class="main">
        <section class="volume-bots" id="volume-bot">
            <h2 class="section-title">Meme Coin Volume Booster (Raydium)</h2>
            <p>Boost your meme coin's trading volume on Raydium with AI-driven automation. Fee: 1 SOL.</p>
            <div class="volume-bot-grid">
                <div class="volume-bot-card">
                    <div class="icon">üåê</div>
                    <h3>Solana Raydium Meme Booster</h3>
                    <p>Enhance your meme coin's volume with randomized trades, multi-wallet rotation, and Jito-powered speed.</p>
                    <form class="volume-bot-form" data-type="solana-raydium-meme">
                        <input type="text" name="tokenMint" placeholder="Meme Coin Mint Address" required>
                        <input type="number" name="volume" placeholder="Target Volume (SOL)" min="1" required>
                        <input type="number" name="wallets" placeholder="Number of Wallets (1-20)" min="1" max="20" required>
                        <input type="number" name="profitThreshold" placeholder="Profit Sell % (e.g., 50)" min="0" required>
                        <button type="submit" class="button">Boost Volume</button>
                    </form>
                    <div class="volume-bot-status"></div>
                    <div class="liquidity-info" id="liquidity-info"></div>
                </div>
            </div>
        </section>

        <section class="sneaker-bot modern-section" id="sneaker-bot">
            <h2 class="section-title sneaker-title">Sneaker Purchase Bot</h2>
            <p class="section-subtitle">Search, confirm, and cop sneakers with ease.</p>
            <div class="sneaker-bot-container">
                <form id="sneaker-search-form" class="sneaker-search-form modern-form">
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="sneaker-name">Sneaker Name</label>
                            <input type="text" id="sneaker-name" placeholder="e.g., Air Jordan 1" required>
                        </div>
                        <div class="form-group">
                            <label for="sneaker-brand">Brand</label>
                            <input type="text" id="sneaker-brand" placeholder="e.g., Nike">
                        </div>
                        <div class="form-group">
                            <label for="sneaker-size">Size</label>
                            <select id="sneaker-size">
                                <option value="">Select Size</option>
                                <option value="7">7</option>
                                <option value="8">8</option>
                                <option value="9">9</option>
                                <option value="10">10</option>
                                <option value="11">11</option>
                                <option value="12">12</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="custom-url">Custom URL (Optional)</label>
                            <input type="text" id="custom-url" placeholder="e.g., https://stockx.com/sneaker">
                        </div>
                    </div>
                    <button type="submit" class="button primary-button">Search Sneakers</button>
                </form>
                <div id="search-results" class="search-results"></div>

                <form id="sneaker-purchase-form" class="sneaker-purchase-form modern-form" style="display: none;">
                    <div class="form-group">
                        <label for="selected-url">Selected Product URL</label>
                        <input type="text" id="selected-url" readonly>
                    </div>
                    <div class="form-group">
                        <label for="quantity">Quantity</label>
                        <input type="number" id="quantity" min="1" max="5" value="1" required>
                    </div>
                    <button type="submit" class="button primary-button sneaker-button">Start Purchase Tasks</button>
                </form>
                <div id="task-container" class="task-container"></div>

                <div id="queue-monitor" class="queue-monitor">
                    <h3>Queue Monitoring</h3>
                    <p>Status: <span id="queue-status">Idle</span></p>
                    <button class="button secondary-button" onclick="startQueueMonitor()">Start Queue Monitor</button>
                </div>

                <div id="barcode-scanner" class="barcode-scanner">
                    <h3>Sneaker Collection</h3>
                    <input type="text" id="barcode-input" placeholder="Scan or Enter Barcode">
                    <button class="button secondary-button" onclick="scanBarcode()">Add to Collection</button>
                    <div id="collection-list"></div>
                </div>
            </div>
        </section>

        <section class="features">
            <h2 class="section-title crypto-title">Supported Payment Methods</h2>
            <div class="crypto-grid">
                <div class="crypto-item"><img src="https://raw.githubusercontent.com/spothq/cryptocurrency-icons/master/32/color/sol.png" alt="Solana"><span>Solana (SOL)</span></div>
                <div class="crypto-item"><img src="https://stripe.com/img/v3/home/social.png" alt="Stripe" style="width: 32px;"><span>Credit Card (Stripe)</span></div>
            </div>
        </section>

        <section class="signup modern-signup" id="signup">
            <div class="signup-content">
                <h2 class="section-title">Join the Revolution</h2>
                <p class="signup-description">Boost your meme coin volume and cop sneakers via Phantom wallet or credit card.</p>
                <form id="signup-form" class="signup-form">
                    <div class="form-group">
                        <input type="email" name="email" class="form-input" placeholder="Enter Your Email" required>
                    </div>
                    <button type="submit" class="button primary-button">Activate Your Account</button>
                </form>
            </div>
        </section>
    </main>

    <footer class="footer modern-footer">
        <div class="footer-content">
            <p>¬© 2025 VoltronBot. All Rights Reserved.</p>
            <div class="social-links">
                <a href="https://x.com" aria-label="X" class="social-link"><i class="fab fa-x-twitter"></i></a>
                <a href="https://discord.com" aria-label="Discord" class="social-link"><i class="fab fa-discord"></i></a>
                <a href="https://telegram.org" aria-label="Telegram" class="social-link"><i class="fab fa-telegram-plane"></i></a>
            </div>
        </div>
    </footer>

    <!-- External Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/particles.js@2.0.0/particles.min.js"></script>
    <script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/buffer@6.0.3/index.min.js"></script>
    <script src="https://unpkg.com/@solana/web3.js@1.95.3/lib/index.iife.min.js"></script>
    <script src="https://js.stripe.com/v3/"></script>

    <script>
        const stripe = Stripe('pk_test_your_publishable_key'); // Replace with your Stripe publishable key
        const BACKEND_URL = 'http://localhost:3000'; // Adjust if deployed

        // Buffer Polyfill
        if (typeof Buffer === 'undefined' || typeof Buffer.from !== 'function') {
            window.Buffer = window.Buffer || {};
            window.Buffer.from = function(data) {
                if (Array.isArray(data) || data instanceof Uint8Array) {
                    return new Uint8Array(data);
                } else if (typeof data === 'string') {
                    return new TextEncoder().encode(data);
                }
                throw new Error('Unsupported Buffer.from input');
            };
            window.Buffer.alloc = function(size) {
                return new Uint8Array(size);
            };
        }

        // Particle.js Setup
        particlesJS("particles-js", {
            particles: {
                number: { value: 120, density: { enable: true, value_area: 800 } },
                color: { value: "#39ff14" },
                shape: { type: "polygon", polygon: { nb_sides: 6 } },
                opacity: { value: 0.7, random: true },
                size: { value: 3, random: true },
                line_linked: { enable: true, distance: 100, color: "#ff1a8c", opacity: 0.6, width: 1.2 },
                move: { enable: true, speed: 2, direction: "none", random: true, straight: false, out_mode: "out" }
            },
            interactivity: {
                detect_on: "canvas",
                events: { onhover: { enable: true, mode: "grab" }, onclick: { enable: true, mode: "push" }, resize: true },
                modes: { grab: { distance: 150, line_linked: { opacity: 0.8 } }, push: { particles_nb: 4 } }
            },
            retina_detect: true
        });

        // Wallet Connection
        let connectedWallet = null;
        async function connectWallet() {
            const solProvider = window.solana;
            if (!solProvider || !solProvider.isPhantom) {
                document.getElementById('wallet-status').textContent = 'Please install Phantom wallet.';
                return;
            }
            try {
                await solProvider.connect();
                connectedWallet = { address: solProvider.publicKey.toString(), provider: solProvider };
                document.getElementById('wallet-status').textContent = `Connected: ${connectedWallet.address.slice(0, 6)}...${connectedWallet.address.slice(-4)}`;
            } catch (error) {
                document.getElementById('wallet-status').textContent = 'Connection failed.';
            }
        }

        // Sneaker Bot Logic
        const searchForm = document.getElementById('sneaker-search-form');
        const purchaseForm = document.getElementById('sneaker-purchase-form');
        const searchResults = document.getElementById('search-results');
        const taskContainer = document.getElementById('task-container');

        searchForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const name = document.getElementById('sneaker-name').value;
            const brand = document.getElementById('sneaker-brand').value;
            const size = document.getElementById('sneaker-size').value;
            const customUrl = document.getElementById('custom-url').value;
            searchResults.innerHTML = '<p>Searching...</p>';
            const results = customUrl ? [{ url: customUrl, name, brand: brand || 'Unknown', size: size || 'N/A', price: null, store: 'Custom', inStock: true, productId: 'custom' }] : await searchSneakers(name, brand, size);
            displaySearchResults(results);
        });

        async function searchSneakers(name, brand, size) {
            try {
                const response = await fetch(`${BACKEND_URL}/search-sneakers?name=${encodeURIComponent(name)}&brand=${encodeURIComponent(brand || '')}&size=${encodeURIComponent(size || '')}`);
                if (!response.ok) throw new Error(`Search request failed: ${await response.text()}`);
                return await response.json();
            } catch (error) {
                console.error('Search error:', error);
                searchResults.innerHTML = `<p>Failed to search sneakers: ${error.message}</p>`;
                return [];
            }
        }

        function displaySearchResults(results) {
            searchResults.innerHTML = '';
            if (results.length === 0) {
                searchResults.innerHTML = '<p>No sneakers found in stock.</p>';
                return;
            }
            results.forEach(result => {
                const item = document.createElement('div');
                item.classList.add('search-result-item');
                item.innerHTML = `
                    <p>${result.name} - Size ${result.size} @ ${result.store} ${result.price ? `($${result.price})` : '(Price unavailable)'}</p>
                    <button class="button secondary-button" onclick="selectSneaker('${result.url}', ${result.price || 0}, '${result.productId}')">Select</button>
                `;
                searchResults.appendChild(item);
            });
        }

        let selectedPrice = 0;
        let selectedProductId = '';
        function selectSneaker(url, price, productId) {
            document.getElementById('selected-url').value = url;
            selectedPrice = price;
            selectedProductId = productId;
            purchaseForm.style.display = 'block';
            taskContainer.innerHTML = '';
        }

        purchaseForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const url = document.getElementById('selected-url').value;
            const quantity = parseInt(document.getElementById('quantity').value);
            startPurchaseTasks(url, quantity);
        });

        async function startPurchaseTasks(url, quantity) {
            taskContainer.innerHTML = '';
            for (let i = 1; i <= 4; i++) {
                const taskCard = document.createElement('div');
                taskCard.classList.add('task-card');
                taskCard.innerHTML = `
                    <div class="status-dot" id="task-${i}-dot"></div>
                    <h4>Task ${i}</h4>
                    <p id="task-${i}-status">Starting...</p>
                    <div id="task-${i}-payment" class="payment-options" style="display: none;">
                        <label><input type="radio" name="payment-${i}" value="wallet" ${connectedWallet ? '' : 'disabled'}> Wallet (${quantity} SOL)</label>
                        <label><input type="radio" name="payment-${i}" value="card"> Credit Card ${selectedPrice ? `($${selectedPrice * quantity})` : '(Price TBD)'}</label>
                        <button class="button primary-button" onclick="confirmPayment(${i}, '${url}', ${quantity})">Confirm Payment</button>
                    </div>
                `;
                taskContainer.appendChild(taskCard);
                runPurchaseTask(i, url, quantity);
            }
        }

        async function runPurchaseTask(taskId, url, quantity) {
            const statusDot = document.getElementById(`task-${taskId}-dot`);
            const statusText = document.getElementById(`task-${taskId}-status`);
            const paymentOptions = document.getElementById(`task-${taskId}-payment`);
            statusDot.style.backgroundColor = 'green';

            try {
                statusText.textContent = 'Adding to cart...';
                const cartResponse = await fetch(`${BACKEND_URL}/add-to-cart`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ productId: selectedProductId, quantity })
                });
                if (!cartResponse.ok) throw new Error(`Cart request failed: ${await cartResponse.text()}`);
                const cartData = await cartResponse.json();
                if (!cartData.success) throw new Error(cartData.error || 'Cart addition failed');

                statusText.textContent = 'Proceeding to checkout...';
                statusDot.style.backgroundColor = 'yellow';

                statusText.textContent = 'Checking billing...';
                if (!localStorage.getItem('billingInfo')) {
                    statusText.textContent = 'Opening billing page...';
                    const confirmed = await openBillingPopup(url, quantity);
                    if (!confirmed) throw new Error('Billing not confirmed');
                }

                statusText.textContent = 'Select payment method...';
                paymentOptions.style.display = 'block';
                const paymentMethod = await waitForPaymentConfirmation(taskId);
                statusText.textContent = 'Processing payment...';
                paymentOptions.style.display = 'none';

                const checkoutResult = await checkout(url, quantity, paymentMethod);
                if (!checkoutResult.success) throw new Error(checkoutResult.error || 'Checkout failed');

                statusText.textContent = `Purchase complete! ${checkoutResult.signature ? 'Tx: ' + checkoutResult.signature : 'Card processed'}`;
                statusDot.style.backgroundColor = 'green';
                const history = JSON.parse(localStorage.getItem('purchaseHistory') || '[]');
                history.push({ url, price: paymentMethod === 'wallet' ? quantity : selectedPrice * quantity, method: paymentMethod });
                localStorage.setItem('purchaseHistory', JSON.stringify(history));
            } catch (error) {
                statusText.textContent = `Failed: ${error.message}`;
                statusDot.style.backgroundColor = 'red';
                paymentOptions.style.display = 'none';
            }
        }

        function waitForPaymentConfirmation(taskId) {
            return new Promise((resolve) => {
                window[`confirmPayment${taskId}`] = (method) => resolve(method);
            });
        }

        async function confirmPayment(taskId, url, quantity) {
            const paymentMethod = document.querySelector(`input[name="payment-${taskId}"]:checked`)?.value;
            if (!paymentMethod) return alert('Please select a payment method');
            window[`confirmPayment${taskId}`](paymentMethod);
        }

        async function checkout(url, quantity, paymentMethod) {
            if (paymentMethod === 'wallet') {
                if (!connectedWallet) return { success: false, error: 'Wallet not connected' };
                try {
                    const response = await fetch(`${BACKEND_URL}/process-solana-payment`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ senderAddress: connectedWallet.address, amount: quantity })
                    });
                    if (!response.ok) throw new Error(`Transaction creation failed: ${await response.text()}`);
                    const { transaction } = await response.json();

                    const tx = solanaWeb3.Transaction.from(Buffer.from(transaction, 'base64'));
                    const signedTx = await connectedWallet.provider.signTransaction(tx);
                    const serializedTx = signedTx.serialize();
                    const signature = await solanaWeb3.Connection('https://api.mainnet-beta.solana.fm', 'confirmed').sendRawTransaction(serializedTx);

                    const confirmResponse = await fetch(`${BACKEND_URL}/confirm-solana-transaction`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ signature })
                    });
                    if (!confirmResponse.ok) throw new Error(`Confirmation failed: ${await confirmResponse.text()}`);
                    return await confirmResponse.json();
                } catch (error) {
                    console.error('Wallet checkout error:', error);
                    return { success: false, error: error.message || 'Transaction error' };
                }
            } else if (paymentMethod === 'card') {
                const billingInfo = JSON.parse(localStorage.getItem('billingInfo') || '{}');
                if (!billingInfo.card) return { success: false, error: 'Credit card info not provided' };
                if (!selectedPrice) return { success: false, error: 'Price not available for this sneaker' };
                try {
                    const response = await fetch(`${BACKEND_URL}/create-payment-intent`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            amount: selectedPrice * quantity * 100, // Convert to cents
                            currency: 'usd',
                            description: `Purchase of ${quantity} sneakers from ${url}`
                        })
                    });
                    if (!response.ok) throw new Error(`Payment intent creation failed: ${await response.text()}`);
                    const { clientSecret } = await response.json();

                    const { paymentIntent, error } = await stripe.confirmCardPayment(clientSecret, {
                        payment_method: {
                            card: {
                                number: billingInfo.card,
                                exp_month: parseInt(billingInfo.expiry.split('/')[0]),
                                exp_year: parseInt(billingInfo.expiry.split('/')[1]),
                                cvc: billingInfo.cvv
                            },
                            billing_details: {
                                name: billingInfo.name,
                                address: { line1: billingInfo.address }
                            }
                        }
                    });
                    if (error) throw new Error(error.message);
                    return { success: true, signature: paymentIntent.id };
                } catch (error) {
                    console.error('Card checkout error:', error);
                    return { success: false, error: error.message || 'Payment error' };
                }
            }
        }

        async function openBillingPopup(url, quantity) {
            return new Promise((resolve) => {
                const popup = window.open('billing.html', 'Billing Confirmation', 'width=600,height=400');
                if (!popup) {
                    alert('Please allow popups for this site');
                    resolve(false);
                    return;
                }
                localStorage.setItem('pendingPurchase', JSON.stringify({ url, quantity }));
                const checkInterval = setInterval(() => {
                    if (popup.closed) {
                        clearInterval(checkInterval);
                        const confirmed = localStorage.getItem('purchaseConfirmed') === 'true';
                        localStorage.removeItem('purchaseConfirmed');
                        localStorage.removeItem('pendingPurchase');
                        resolve(confirmed);
                    }
                }, 500);
            });
        }

        // Queue Monitoring (Not implemented due to StockX API limitations)
        const queueStatus = document.getElementById('queue-status');
        async function startQueueMonitor() {
            queueStatus.textContent = 'Queue monitoring not available with current StockX API.';
        }

        // Barcode Scanner
        const collectionList = document.getElementById('collection-list');
        async function scanBarcode() {
            const barcode = document.getElementById('barcode-input').value;
            if (!barcode) return;
            try {
                const response = await fetch(`${BACKEND_URL}/search-sneakers?name=${encodeURIComponent(barcode)}`);
                if (!response.ok) throw new Error(`Barcode search failed: ${await response.text()}`);
                const sneakers = await response.json();
                if (sneakers.length === 0) throw new Error('No sneaker found for this barcode');
                const sneaker = sneakers[0];
                const item = document.createElement('div');
                item.innerHTML = `
                    <p>${sneaker.name} - Resale: $${sneaker.price}</p>
                    <p>Brand: ${sneaker.brand} | Size: ${sneaker.size}</p>
                `;
                collectionList.appendChild(item);
                document.getElementById('barcode-input').value = '';
            } catch (error) {
                console.error('Barcode error:', error);
                collectionList.innerHTML += `<p>Failed to fetch sneaker info: ${error.message}</p>`;
            }
        }

        // Volume Bot Logic (Placeholder)
        document.querySelector('.volume-bot-form').addEventListener('submit', (e) => {
            e.preventDefault();
            alert('Volume boost not implemented yet.');
        });
    </script>
</body>
</html>